

{% extends 'base.html' %}

	{% block content %}
  {% load ratings %}
  {% load staticfiles %}
<!-- found how to make the advanced search form here: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_popup_form-->
<!-- found how to make the price sliding bar here: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_rangeslider-->
<!-- and had help here: https://stackoverflow.com/questions/10004723/html5-input-type-range-show-range-value -->
<!-- drop down filtering: https://www.w3schools.com/html/html_form_elements.asp-->
<!-- help with drop downs: https://getbootstrap.com/docs/4.0/components/dropdowns/ -->
  <style>

.open-advanced{
/*  background-color: transparent;*/
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
/*  opacity: 0.8;*/
  position: fixed;
  top: 0%;
  right: 10%;
 /* width: 280px;
  height: 40px;*/
}

.form-advanced{
  font-family: 'Nunito', sans-serif;
  color: #666666;
  display: none;
  position: absolute;
  top: 70px;
  right: 0px;
  /*border: 3px solid #f1f1f1;*/
  background-color: white;
  opacity: 1;
  z-index: 100;
  width: 55%;
  height: 500px;
}

.form-container {
  max-width: 300px;
  padding: 10px;
  background-color: white;
}

.form-container input[type=bedrooms-filtering]:focus {
  width: 100%;
  padding: 15px;
  margin: 5px 0 22px 0;
  border: none;
  background: #f1f1f1;
}

.form-container input[type=price-filtering], .form-container input[type=bedrooms-filtering] {
  width: 100%;
  padding: 15px;
  margin: 5px 0 22px 0;
  border: none;
  background: #f1f1f1;
}

.form-container .btn {
  background-color: #4CAF50;
  color: white;
  padding: 16px 20px;
  border: none;
  cursor: pointer;
  width: 100%;
  margin-bottom:10px;
  opacity: 0.8;
}

.form-container .btn:hover, .open-button:hover {
  opacity: 1;
}

.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}


div.table {
  background-color: #FDFDFD;
  width:100%;
  height: 500px;
  overflow: auto;
}
.star-ratings-rating-average {
  display: none;
 }

 .star-ratings-rating-count {
  display: none;
 }

 .star-ratings-rating-user {
  display: none;
 }

#apartment_stars{
    position: relative;
    left: 40%;
    top: 100%;
    transform: translate(-91%, 100%);
}

.page-link{
  color: #dc858e;
}

.page-link:hover{
  color: #dc858e;
}

.page-link:active{
  color: #dc858e;
  border-color: #dc858e;
}

.page-link:focus {
  outline: none;
  box-shadow: none;
}

.page-item.active .page-link{
  background-color: #dc858e;
  border-color: #dc858e;
}



</style>

  <div class="apartments_background_image"></div>


  <div class="apartments_content_container" id="outer_container_apartments">


    <div class="container, apartments_div">

   <!-- <div>
            {% if compare0 %}
        <p class="text-left"> 1st Compare: {{compare0}}</p>
            {% else %}
                <button class="btn btn-flat btn" style="float: left;color:white"> 1st Compare: None Selected</button>
            {% endif %}
            {% if compare1 %}
                <p class="text-left">2nd Compare: {{compare1}}</p>
            {% else %}
                <button class="btn btn-flat btn" style="float: left"> 2nd Compare: None Selected</button>
            {% endif %}
            </div>-->
        <!-- <div class="col"> -->
          
        <!-- </div> -->

        <div class="col" id="apartments_image_div">
             {% if user and not user.is_anonymous %}
              <div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="float: left; margin-top: 0.5%; background: none; border: none;">
    Selected Compare
  </button>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      {% if compare0 %}
      <h6 class="dropdown-header">First Compare: </h6>
    <a class="dropdown-item" href="{% url 'apartment_detail' compare0.id %}">{{ compare0 }}</a>
      {% else %}
    <a class="dropdown-item" href="#">None Selected</a>
      {% endif %}
      {% if compare1 %}
      <h6 class="dropdown-header">Second Compare: </h6>
    <a class="dropdown-item" href="{% url 'apartment_detail' compare1.id %}">{{ compare1 }}</a>
      {% else %}
    <a class="dropdown-item" href="#">None Selected</a>
      {% endif %}
      <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="{% url 'compare' %}">Go to Compare Page</a>
  </div>
</div>
            {% endif %}

        <!--  <div class="btn-group-vertical" style="float: left;">
              {% if compare0 %}
        <button class="btn btn-flat btn" style="float: left;color:white"> 1st Compare: {{compare0}}</button>
            {% else %}
                <button class="btn btn-flat btn" style="float: left;color:white"> 1st Compare: None Selected</button>
            {% endif %}
            {% if compare1 %}
                <button class="btn btn-flat btn" style="float: left;color:white">2nd Compare: {{compare1}}</button>
            {% else %}
                <button class="btn btn-flat btn" style="float: left"> 2nd Compare: None Selected</button>
            {% endif %}
          </div>-->

          <!-- <input type="link" class="btn btn-default" id="advanced_search" value="Advanced Search"> -->


          <div id="search_bar_div" style="float: left; margin-left: 5%;">


            <form action="/apartments" id="search_bar_apartments" method="get">
              <div class="input-group mb-3">
                <input type="text" class="form-control" name="search" placeholder="Search" id="search_bar_id_apartments">
                <div class="input-group-append">
                  <input type="submit" class="btn btn-primary" id="search_button_apartments" value="Search">
                </div>
              </div>
            </form>


         </div>
                  <div id="filtering">
              <button class="open-advanced btn btn-default" onclick="openForm()" style="">Advanced Search</button>
              <div class="form-advanced form-group" id="myForm" >
                <button class="btn btn-default" onclick="closeForm()" style="float: left;"> Cancel</button>
                  <h1 >Filter</h1>
                 <form action="/filter" name=filtering">

                 <div class="slidecontainer" style="float: left;">
                     <label for="price-filtering"><b>Max Price</b></label>
                        <input type="range" name="max_price_input" id="max_price_inputId" value="maxPriceInput" min="0" max="3500"
                            oninput="max_price_outputId.value = max_price_inputId.value" step="50">
                    {% if maxPriceInput %}
                        <output name="max_price_output" id="max_price_outputId">{{ maxPriceInput }}</output>
                     {% else %}
                        <output name="max_price_output" id="max_price_outputId">3500</output>
                     {% endif %}
                 </div>
                    <div class="input-group mb-3 selector_advanced">
                      <div class="input-group-prepend">
                        <label class="input-group-text" for="bedrooms-filtering">Bedrooms</label>
                      </div>
                      <select name="bedroomInput" class="custom-select">
                          {% if bedroomInput %}
                          <option value=bedroomInput> {{ bedroomInput }}</option>
                          {% endif %}
                        <option value="No Filter">No Filter</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                      </select>
                    </div>

                  <h1>Sort</h1>
                    <div class="input-group mb-3 selector_advanced">
                      <div class="input-group-prepend">
                        <label class="input-group-text" for="sorting">Price: </label>
                      </div>
                    <select name="sortInput" class="custom-select">
                        <option value=priceFilter>{{priceFilter}}</option>
                      <option value="No Sort">No Sort</option>
                      <option value="Sort by Price (low to high)"> Low to High </option>
                      <option value="Sort by Price (high to low)"> High to Low</option>
                    </select>
                  </div>
                  <div class="input-group mb-3 selector_advanced">
                    <div class="input-group-prepend">
                      <label class="input-group-text" for="sorting">Rating: </label>
                    </div>
                  <select name="ratingInput" class="custom-select">
                      <option value=ratingInput>{{ratingInput}}</option>
                    <option value="No Sort">No Sort</option>
                    <option value="Sort by Average Rating (high to low)"> High to Low</option>
                    <option value="Sort by Average Rating (low to high)"> Low to High</option>
                  </select>
                </div>
                  <input type="submit" name="filtering" class="btn btn-primary" style="background-color: #7eebbc; border-color: #67bb96;">   
                    </form>

</div>


<script>
function openForm() {
  document.getElementById("myForm").style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
}
</script>
                  </div>

        </div>
      <div class="row justify-content-md-center" id="middle_row_apartments">



        <div class="col-md-auto" id="main_col_left_apartments">

          <!--Adding Maps-->

             <div id="map"></div>

             <script>

              function initMap() {

              var custom_icon_path_1 = "{% static "images/pin_pink.png" %}"
              var custom_icon_path_2 = "{% static "images/pin_green.png" %}"

              var apartments = "{{apartments}}";

              console.log(apartments);

              // custom_icon = {
              //         url: custom_icon_path_1,
              //         size: new google.maps.Size(20, 38),
              //         scaledSize: new google.maps.Size(20, 38),
              //         labelOrigin: new google.maps.Point(30, 30),
              // };

              // custom_icon_2 = {
              //         url: custom_icon_path_2,
              //         size: new google.maps.Size(20, 38),
              //         scaledSize: new google.maps.Size(20, 38),
              //         labelOrigin: new google.maps.Point(30, 30),
              // };

              // var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';

              var apt_coordinates = {lat: 38.0325982, lng: -78.4955055};
              var apt_coor_2 = {lat:38.0327987, lng: -78.4952891};
              var apt_coor_3 ={lat:38.037524, lng:-78.4989593}; 
              var apt_coor_4 ={lat:38.0372172, lng:-78.5015677}; 
              var apt_coor_5 ={lat:38.0286472 , lng:-78.5112196 }; 
              var apt_coor_6 ={lat:38.0316282, lng: -78.4842689};

               var apt_coor_7 ={lat:38.0350752, lng:-78.4981588};
              var apt_coor_8 ={lat:38.0416242, lng:-78.503709};
              //var apt_coor_9a ={lat:38.0698574, lng:-78.4659562;
              var apt_coor_10 ={lat:38.0286541, lng:-78.4816677};
              var apt_coor_11 ={lat:38.0423332, lng:-78.5114287};
              var apt_coor_12 ={lat:38.0410028, lng:-78.50382};
              var apt_coor_13 ={lat:38.0698574, lng:78.4659562};
              // var geocoder;
              var map = new google.maps.Map(document.getElementById('map'), { center: apt_coordinates,
              zoom: 14,
              styles: [
  {
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#f5f5f5"
      }
    ]
  },
  {
    "elementType": "labels.icon",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "weight": 1.5
      }
    ]
  },
  {
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "weight": 1.5
      }
    ]
  },
  {
    "featureType": "administrative.land_parcel",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#bdbdbd"
      }
    ]
  },
  {
    "featureType": "administrative.locality",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#ffb0b8"
      },
      {
        "weight": 2
      }
    ]
  },
  {
    "featureType": "administrative.locality",
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "color": "#dc858e"
      },
      {
        "weight": 1
      }
    ]
  },
  {
    "featureType": "landscape.man_made",
    "elementType": "geometry",
    "stylers": [
      {
        "visibility": "simplified"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "geometry.stroke",
    "stylers": [
      {
        "weight": 1.5
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#ffffff"
      }
    ]
  },
  {
    "featureType": "road.arterial",
    "elementType": "geometry.fill",
    "stylers": [
      {
        "weight": 3
      }
    ]
  },
  {
    "featureType": "road.arterial",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#dadada"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#616161"
      }
    ]
  },
  {
    "featureType": "road.local",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "transit.line",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "transit.station",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#c9c9c9"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  }
]
              });

              var marker = new google.maps.Marker({position: apt_coordinates, map: map, label: 'The Flats', icon: custom_icon_path_1});
              var marker2 = new google.maps.Marker({position: apt_coor_2, map: map, label: 'Venable', icon: custom_icon_path_1}); 
             //var marker3 = new google.maps.Marker({position: apt_coor_3, map: map},label: 'The Standard'}); 
              var marker4 = new google.maps.Marker({position: apt_coor_4, map: map, label: 'Grandmarc', icon: custom_icon_path_1}); 
              var marker5 = new google.maps.Marker({position: apt_coor_5, map: map, label: '1800 JPA', icon: custom_icon_path_1}); 
             var marker6 = new google.maps.Marker({position: apt_coor_6, map: map, label: '112 West Market St.', icon: custom_icon_path_1});
              var marker7 = new google.maps.Marker({position: apt_coor_7, map: map, label: '1115 Wertland St.', icon: custom_icon_path_1});
              var marker8 = new google.maps.Marker({position: apt_coor_8, map: map, label: '64 University Way', icon: custom_icon_path_1});

               var marker10 = new google.maps.Marker({position: apt_coor_10, map: map, label: '300 4th St. SE', icon: custom_icon_path_1});
              var marker11 = new google.maps.Marker({position: apt_coor_11, map: map, label: '2021 Ivy Rd', icon: custom_icon_path_1});
              var marker12 = new google.maps.Marker({position: apt_coor_12, map: map, label: '1801 Lambeth Lane', icon: custom_icon_path_1});
              var marker13 = new google.maps.Marker({position: apt_coor_13, map: map, label: 'Reserve at Belvedere', icon:custom_icon_path_1});


            // This is hard coded and terrible but it's just meant to show how the functionality works, sorry for the mess
                google.maps.event.addListener(marker, 'mouseover', function() {
                    marker.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker, 'mouseout', function() {
                    marker.setIcon(custom_icon_path_1);
                });

                google.maps.event.addListener(marker2, 'mouseover', function() {
                    marker2.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker2, 'mouseout', function() {
                    marker2.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker4, 'mouseover', function() {
                    marker4.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker4, 'mouseout', function() {
                    marker4.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker5, 'mouseover', function() {
                    marker5.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker5, 'mouseout', function() {
                    marker5.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker6, 'mouseover', function() {
                    marker6.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker6, 'mouseout', function() {
                    marker6.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker7, 'mouseover', function() {
                    marker7.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker7, 'mouseout', function() {
                    marker7.setIcon(custom_icon_path_1);
                });
               google.maps.event.addListener(marker8, 'mouseover', function() {
                    marker8.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker8, 'mouseout', function() {
                    marker8.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker10, 'mouseover', function() {
                    marker10.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker10, 'mouseout', function() {
                    marker10.setIcon(custom_icon_path_1);
                });
               google.maps.event.addListener(marker11, 'mouseover', function() {
                    marker11.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker11, 'mouseout', function() {
                    marker11.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker12, 'mouseover', function() {
                    marker12.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker12, 'mouseout', function() {
                    marker12.setIcon(custom_icon_path_1);
                });

               google.maps.event.addListener(marker13, 'mouseover', function() {
                    marker13.setIcon(custom_icon_path_2);
                });
                google.maps.event.addListener(marker13, 'mouseout', function() {
                    marker13.setIcon(custom_icon_path_1);
                });
            }

             </script>

                <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBnnca1doBE-nE14750VNFA4VtqlLrcJZk&callback=initMap">
                </script>

        </div>
        <div class="col-md-auto" id="main_col_right_apartments">

          <div class="container, apartments_div_detail">
              <div class="table">
                  {% for apartment in apartments %}
                  <tr>
                      <td>
                          <div>
                              <img style="vertical-align:middle" src={{apartment.image}} id="apartment_thumbnail">
                              <div class='apartmentname' align="center" style="padding-bottom:30px">
                                  <a href="{% url 'apartment_detail' apartment.id %}" id="apartment_link">
                                      <h4> {{ apartment.name|capfirst }} </h4>
                                  </a>
                                  <h5 id="apartment_price">{{ apartment.price }} </h5>
                                  <h5 id="apartment_bedbath">Bedrooms: {{ apartment.bedrooms }} </h5>
                                  <h5 id="apartment_bath"> Bathrooms: {{apartment.bathrooms }}</h5>
                                  <link rel="stylesheet" href="{% static 'star-ratings/css/star-ratings.css' %}">
                                  <script type="text/javascript"
                                          src="{% static 'star-ratings/js/dist/star-ratings.min.js' %}"></script>
                                  <div id="apartment_stars" style="">
                                      <div class="star-ratings">
                                          {% ratings apartment read_only=True %}
                                      </div>
                                  </div>
                                  {% if user and not user.is_anonymous %}
                                  <div>
                                      <a class="page-link" href="{% url 'save_favorite' apartment.id %}"
                                         style="width: 50%; margin-left: 30%; padding: 1%">Save to Favorites List </a>
                                      <a class="page-link" href="{% url 'save_compare0' apartment.id %}"
                                         style="width: 50%; margin-left: 30%; padding: 1%">1st Compare Apartment</a>
                                      <a class="page-link" href="{% url 'save_compare1' apartment.id %}"
                                         style="width: 50%; margin-left: 30%; padding: 1%">2nd Compare Apartment</a>
                                  </div>
                                      {% endif %}

                                  </div>


                              </div>
                      </td>
                  </tr>
                  {% endfor %}
              <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center" style="margin-top: 1rem;">
                      {% if apartments.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
                        <li class="page-item"><a class="page-link" href="?page={{ contacts.previous_page_number }}">Previous</a></li>
                      {% else %}
                        <li class="page-item disabled">
                          <a class="page-link" href="#" tabindex="-1">Previous</a>
                        </li>
                      {% endif %}
                      <li class="page-item active">
                        <span class="page-link">
                          Page {{ apartments.number }} of {{ apartments.paginator.num_pages }}
                            <!-- <span class="sr-only">(current)</span> -->
                        </span>
                            </li>
                            {% if apartments.has_next %}
                            <li class="page-item"><a class="page-link"
                                                     href="?page={{ apartments.next_page_number }}">Next</a></li>
                            <li class="page-item"><a class="page-link" href="?page={{ apartments.paginator.num_pages }}">Last
                                &raquo;</a></li>
                            {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1">Last</a>
                            </li>
                            {% endif %}
                        </ul>
                  </nav>
                  </div>
                  {% if not apartments %}
                  <div>
                      <center>No Results.</center>
                  </div>
                  {% endif %}


                  <div class="inner_content_div_apartments">

                  </div>

              </div>
<!--        <div class="col" id="right_outer_col">

        </div> -->
      </div>

    </div>

  </div>

	{% endblock content %}
